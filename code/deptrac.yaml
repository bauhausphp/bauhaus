deptrac:
  ignore_uncovered_internal_classes: true # ignore dependency to internal php classes

  paths:
    - ./packages
    - ./tests
    - ./../composer/code/psr
  exclude_files: ~

  ruleset:
    HttpPort: [ Psr7, Psr15 ]
    ServiceResolver: [ Psr11 ]
    TypeUri: []
    TestHttpPort: [ +HttpPort, PhpUnit ]
    TestServiceResolver: [ +ServiceResolver, PhpUnit ]
    TestTypeUri: [ +TypeUri, PhpUnit ]
    Psr15: [ Psr7 ]

  layers:
    - name: HttpPort
      collectors:
      - { type: directory, value: ./packages/http-port/public/ }
      - { type: directory, value: ./packages/http-port/private/, private: true }

    - name: ServiceResolver
      collectors:
      - { type: directory, value: ./packages/service-resolver/public/ }
      - { type: directory, value: ./packages/service-resolver/private/, private: true }

    - name: TypeUri
      collectors:
      - { type: directory, value: ./packages/type-uri/public/ }
      - { type: directory, value: ./packages/type-uri/private/, private: true }

    - name: TestHttpPort
      collectors:
      - { type: directory, value: ./tests/HttpPort/ }

    - name: TestServiceResolver
      collectors:
      - { type: directory, value: ./tests/ServiceResolver/ }
      - { type: classLike, value: Bauhaus\\Tests\\ServiceResolver\\Doubles\\NotFoundService }

    - name: TestTypeUri
      collectors:
      - { type: directory, value: ./tests/Types/UriTest.php }

    - name: Psr7
      collectors:
      - { type: directory, value: ../composer/code/psr/http-message/ }

    - name: Psr11
      collectors:
      - { type: directory, value: ../composer/code/psr/container/ }

    - name: Psr15
      collectors:
      - { type: directory, value: ../composer/code/psr/http-server-handler/ }

    - name: PhpUnit
      collectors:
      - { type: classLike, value: PHPUnit\\Framework\\TestCase }

  formatters:
    graphviz:
      groups:
        Packages:
        - HttpPort
        - ServiceResolver
        - TypeUri
        Tests:
        - TestHttpPort
        - TestServiceResolver
        - TestTypeUri
        PSRs:
        - Psr7
        - Psr11
        - Psr15
        Vendor:
        - PhpUnit
